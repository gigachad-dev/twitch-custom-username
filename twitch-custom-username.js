var __defProp=Object.defineProperty,__defNormalProp=(o,s,i)=>s in o?__defProp(o,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):o[s]=i,__publicField=(o,s,i)=>(__defNormalProp(o,typeof s!="symbol"?s+"":s,i),i),__accessCheck=(o,s,i)=>{if(!s.has(o))throw TypeError("Cannot "+i)},__privateGet=(o,s,i)=>(__accessCheck(o,s,"read from private field"),i?i.call(o):s.get(o)),__privateAdd=(o,s,i)=>{if(s.has(o))throw TypeError("Cannot add the same private member more than once");s instanceof WeakSet?s.add(o):s.set(o,i)},__privateSet=(o,s,i,m)=>(__accessCheck(o,s,"write to private field"),m?m.call(o,i):s.set(o,i),i);(function(){var o,s,i;function m(e,t,n){const a=new MutationObserver((r,c)=>{for(const l of r)t(l,c)});return a.observe(e,{childList:!0,subtree:!0,...n}),()=>a.disconnect()}const A="chat-line__message",N="user-notice-line",S="chat-author__display-name",p="data-user-id",d="customNames",_="__reactInternalInstance",U="https://twurple-bot.na4u.ru/users";class R{constructor(){__publicField(this,"reactInternalInstanceKey",null)}getReactInstance(t){if(!this.reactInternalInstanceKey){const n=Object.keys(t).find(a=>a.startsWith(_));if(!n)throw new Error(`${_} is not defined`);this.reactInternalInstanceKey=n}return t[this.reactInternalInstanceKey]}getUserId(t){const n=this.getReactInstance(t);return n.return.key?n.return.key.split("-").at(0):null}}const E=new R;function g(e){return Object.entries(e)}const y=(e,t)=>e;class w{constructor({encode:t=y,decode:n=y,attributes:a={},initialValue:r}={}){if(__privateAdd(this,o,void 0),__privateAdd(this,s,void 0),__privateAdd(this,i,void 0),__privateSet(this,o,t),__privateSet(this,s,n),this.attributes=a,r)for(const[c,l]of g(r))this.has(c)||this.set(c,l)}get attributes(){return __privateGet(this,i)}set attributes(t){__privateSet(this,i,t)}get(t){const n=`; ${document.cookie}`.match(`;\\s*${t}=([^;]+)`);return n?__privateGet(this,s).call(this,decodeURIComponent(n[1]),t):null}set(t,n,a){const r={path:"/",...__privateGet(this,i),...a};typeof r.expires=="number"&&(r.expires=new Date(Date.now()+r.expires*864e5)),r.expires instanceof Date&&(r.expires=r.expires.toUTCString());let c=`${encodeURIComponent(t)}=${encodeURIComponent(__privateGet(this,o).call(this,n,t))}`;for(const[l,C]of g(r))c+=`; ${l}`,C!==!0&&(c+=`=${C}`);document.cookie=c}list(){const t=document.cookie,n=(t?t.split("; "):[]).map(a=>{const[r,c]=a.split(/=(.*)/);return[r,__privateGet(this,s).call(this,decodeURIComponent(c),r)]});return Object.fromEntries(n)}remove(t,n){this.set(t,null,{...n,expires:-1})}has(t){return!!this.get(t)}}o=new WeakMap,s=new WeakMap,i=new WeakMap;const I=new w({attributes:{domain:"twitch.tv","max-age":60*60*24*365},encode(e){return JSON.stringify(e)},decode(e){try{return JSON.parse(e)}catch{return null}}});class O{constructor(){__publicField(this,"STORAGE_VALUES"),this.init()}get values(){return this.STORAGE_VALUES}init(){if(this.read(),GM_addValueChangeListener(d,(t,n,a,r)=>{r&&(this.STORAGE_VALUES=a)}),!this.STORAGE_VALUES.length){const t=I.get(d);if(!t)return;this.write(t),I.remove(d)}}read(){return this.STORAGE_VALUES=GM_getValue(d,[]),this.STORAGE_VALUES}write(t){t&&(this.STORAGE_VALUES=t),GM_setValue(d,this.STORAGE_VALUES)}addCustomName(t){const[n,a]=t,r=this.read();this.STORAGE_VALUES=r.filter(c=>c[0]!==n),a&&this.STORAGE_VALUES.push(t),this.write()}getCustomNameById(t){const n=this.STORAGE_VALUES.find(a=>a[0]===t);return n?n[1]:null}}const u=new O;function T(e,t){const n=e.getAttribute(p);if(n)return u.getCustomNameById(n);{const a=E.getUserId(t);return a?u.getCustomNameById(a):null}}function L(e){for(const t of e.addedNodes){if(t.nodeName==="#text")continue;const n=t;if(!(n.classList.contains(A)||n.classList.contains(N)))continue;const r=n.querySelector(`.${S}`);if(!r)continue;const c=T(n,r);c&&(r.innerHTML=`${r.textContent} (${c})`)}}async function v(e){return await(await fetch(U,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e})})).json()}function G(e){e.altKey&&e.key==="1"&&(e.preventDefault(),navigator.clipboard.writeText(JSON.stringify(u.values)).then(()=>alert("Copied to clipboard!")))}function b(e){if(e.altKey&&e.key==="2"){e.preventDefault();const t=prompt("Set a new storage value:",JSON.stringify(u.values));if(!t)return;try{u.write(JSON.parse(t))}catch(n){alert(`Failed to parse JSON: ${n.message}`)}}}function V(e){const t=e.target;if(e.altKey&&t.classList.contains(S)){e.preventDefault();const n=E.getUserId(t)||t.parentElement.parentElement.getAttribute(p)||t.parentElement.parentElement.parentElement.getAttribute(p);if(!n){alert("User id is not defined");return}const a=u.getCustomNameById(n),r=prompt(`Set a custom name for ${t.textContent}:`,a??"");if(r===null)return;u.addCustomName([n,r])}}async function h(e){if(e.altKey&&e.key==="3"){e.preventDefault();const t=prompt("Search user by name:");if(!t)return h(e);x(e,t)}}async function x(e,t){const n=await v(t);if(n.error)return alert(n.error),h(e);const a=u.getCustomNameById(n.id),r=prompt(`Set a custom name for ${n.displayName}:`,a??"");r!==null&&u.addCustomName([n.id,r])}const f={exportConfig:G,importConfig:b,addCustomUsernameFromChat:V,addCustomUsername:h};document.addEventListener("keydown",e=>{f.exportConfig(e),f.importConfig(e),f.addCustomUsername(e)}),document.addEventListener("contextmenu",e=>{f.addCustomUsernameFromChat(e)}),m(document.body,e=>L(e))})();
